##Modbus/Tcp资料整理

###一、简介:

Modbus协议通讯采用主—从响应方式。主机（又称客户端）为手持端设
备，从机（又称服务端）为可编程控制器。此协议支持传统的RS-232、RS-422、
RS-485和以太网设备，标准的Modbus口是基于RS-485的串行链路，它定义了连接口的引脚、电缆、信号线、传输波特率、奇偶校验。采用Modbus网络，各个主机和从机之间通过半双工形式传输数据，一方在执行请求或者响应的时候，另一方只能等待，因此不会影响各个从机执行自身的任务。主机与从机之间可以单独通讯也可以通过广播的形式通讯。主机为手持端设备，从机为各个PLC采集采集的数据通过组态软件形成的服务端。主机根据Modbus协议规则对从机发送包含功能码的请求数据帧，从机响应并返回带有Modbus协议的响应数据帧。


Modbus协议可以使用两种传输模式，一种是ASCII模式，另一种是RTU模式，一个Modbus网络上的所有设备之间的通讯都必须采用相同的传输模式并配置相同的串口参数。

###二、功能码:

####功能码名称作用:
功能码 | 名称 | 作用
------------ | ------------- | ------------
 01 | 读取线圈状态  | 取得一组逻辑线圈的当前状态（ON/OFF) 
 02 | 读取输入状态  | 取得一组开关输入的当前状态（ON/OFF)
 03 | 读取保持寄存器  | 在一个或多个保持寄存器中取得当前的二进制值
 04| 读取输入寄存器  | 在一个或多个输入寄存器中取得当前的二进制值 
 05  | 强置单线圈  | 强置一个逻辑线圈的通断状态
06 | 预置单寄存器  | 把具体二进值装入一个保持寄存器
07  | 读取异常状态  | 取得8个内部线圈的通断状态，这8个线圈的地址由控制器决定，用户逻辑可以将这些线圈定义，以说明从机状态，短报文适宜于迅速读取状态
08  | 回送诊断校验  | 把诊断校验报文送从机，以对通信处理进行评鉴
09 | 编程（只用于484）  | 使主机模拟编程器作用，修改PC从机逻辑
10 | 控询（只用于484）  | 可使主机与一台正在执行长程序任务从机通信，探询该从机是否已完成其操作任务，仅在含有功能码9的报文发送后，本功能码才发送
11  | 读取事件计数  | 可使主机发出单询问，并随即判定操作是否成功，尤其是该命令或其他应答产生通信错误时
12  | 读取通信事件记录  | 可是主机检索每台从机的ModBus事务处理通信事件记录。如果某项事务处理完成，记录会给出有关错误
13 | 编程（184/384 484 584）  | 可使主机模拟编程器功能修改PC从机逻辑 
14  | 探询（184/384 484 584）  | 可使主机与正在执行任务的从机通信，定期控询该从机是否已完成其程序操作，仅在含有功能13的报文发送后，本功能码才得发送
15  | 强置多线圈  | 强置一串连续逻辑线圈的通断
16  | 预置多寄存器  | 把具体的二进制值装入一串连续的保持寄存器
17 | 报告从机标识  | 可使主机判断编址从机的类型及该从机运行指示灯的状态
18  | （884和MICRO 84）  | 可使主机模拟编程功能，修改PC状态逻辑
19 | 重置通信链路  | 发生非可修改错误后，是从机复位于已知状态，可重置顺序字节
20 | 读取通用参数（584L）  | 显示扩展存储器文件中的数据信息 
21  | 写入通用参数（584L）  | 把通用参数写入扩展存储文件，或修改之
22～64   | 保留  | 作扩展功能备用
65～72 | 保留    | 以备用户功能所用留作用户功能的扩展编码  
73～119 | 非法功能  | 非法功能
120～127 | 保留  | 留作内部作用 
128～255 | 保留  | 用于异常应答

